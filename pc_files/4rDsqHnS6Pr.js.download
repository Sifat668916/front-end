;/*FB_PKG_DELIM*/

__d("LSUpdateOptimisticContextThreadKeys",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.seq([function(c){return b.fe(b.ftr(b.db.table(32).fetch(),function(c){return b.i64.eq(c.threadKey,a[0])}),function(b){var c=b.update;b.item;return c({threadKey:a[1]})})},function(c){return b.fe(b.ftr(b.db.table(31).fetch(),function(c){return b.i64.eq(c.threadKey,a[0])}),function(b){var c=b.update;b.item;return c({threadKey:a[1]})})}])},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSUpdateTaskQueueName",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),function(b){var c=b.update;b.item;return c({queueName:a[1]})})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSUpdateTaskValue",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.fe(b.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),function(b){var c=b.update;b=b.item;return c({taskValue:b.taskValue.split(a[1]).join(a[2])})})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSShimHybridThreadDeleteUtil",["Promise","ReQL"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("mi_act_mapping_table")).getKeyRange(b)).then(function(a){return a})}function c(a,c){if(c!=null)return(h||(h=b("Promise"))).all([a.table("threads")["delete"]({hd:c.serverThreadKey,tl:0}),a.table("mi_act_mapping_table")["delete"]({hd:c.serverThreadKey,tl:{hd:c.clientThreadPk,tl:{hd:c.jid,tl:0}}})]).then(function(){});else return(h||(h=b("Promise"))).resolve()}g.getMiActMappingRow=a;g.deleteE2EEMetadataTable=c}),98);
__d("LSShimHybridThreadDeleteByThreadKey.bs",["LSShimHybridThreadDeleteUtil"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b,c){return d("LSShimHybridThreadDeleteUtil").getMiActMappingRow(a,c).then(function(b){return d("LSShimHybridThreadDeleteUtil").deleteE2EEMetadataTable(a,b)}).then(function(){})}g.call=a}),98);
__d("LSShimHybridThreadDeleteByThreadKey.nop",["LSShimHybridThreadDeleteByThreadKey.bs"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c){return d("LSShimHybridThreadDeleteByThreadKey.bs").call(a,b,c)};g["default"]=a}),98);
__d("LSHybridThreadDelete",["LSShimHybridThreadDeleteByThreadKey.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[];return c.seq([function(d){return c.nop(b("LSShimHybridThreadDeleteByThreadKey.nop"),a[0])},function(a){return c.resolve(d)}])}c=a;f["default"]=c}),66);
__d("LSTransportHybridParticipantUpdateReceipts",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.resolve(c)}b=a;f["default"]=b}),66);
__d("LSReplaceOptimisticThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[];return b.seq([function(c){return b.db.table(9).fetch([[[a[1]]]]).next().then(function(c,d){d=c.done;c=c.value;return d?b.fe(b.ftr(b.db.table(9).fetch([[[a[0]]]]),function(c){return b.i64.eq(c.threadKey,a[0])&&b.i64.le(c.authorityLevel,b.i64.cast([0,20]))}),function(c){var d=c.update;c.item;return d({threadKey:a[1],authorityLevel:b.i64.cast([0,40])})}):(c.item,b.fe(b.db.table(9).fetch([[[a[0]]]]),function(a){return a["delete"]()}))})},function(a){return b.resolve(c)}])}b=a;f["default"]=b}),66);
__d("LSShimGetServerThreadKeyFromJIDV2.bs",["Promise","ReQL","RetUtil"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,c,e){return d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("mi_act_mapping_table").index("jid")).getKeyRange(e)).then(function(a){return a!=null?(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult(a.serverThreadKey)):(h||(h=b("Promise"))).resolve(d("RetUtil").getNullableRetResult())})}g.call=a}),98);
__d("LSShimGetServerThreadKeyFromJIDV2.nop",["LSShimGetServerThreadKeyFromJIDV2.bs"],(function(a,b,c,d,e,f,g){"use strict";a=function(a,b,c){return d("LSShimGetServerThreadKeyFromJIDV2.bs").call(a,b,c)};g["default"]=a}),98);
__d("LSUpdateThreadAuthorityAndMapping",["LSDeleteThread","LSReplaceOptimisticThread","LSShimGetServerThreadKeyFromJIDV2.nop","LSUpdateOptimisticContextThreadKeys","LSUpdateTaskQueueName","LSUpdateTaskValue"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return c.nop(b("LSShimGetServerThreadKeyFromJIDV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){b=a.done;a=a.value;return b?d[1]=!1:(a.item,d[1]=!0)})},function(b){return c.ftr(c.db.table(9).fetch(),function(b){return c.i64.eq(b.threadKey,a[2])}).next().then(function(a,b){b=a.done;a=a.value;return b?d[3]=!1:(a.item,d[3]=!0)})},function(e){return d[5]=c.i64.neq(d[0],f),d[7]=c.i64.eq(d[0],a[2])&&d[5],!d[7]&&!(c.i64.eq(d[0],a[1])&&d[5])&&d[5]?function(a){c.logger(a).mustfix(a)}("The mi_act_mapping row did not correspond to either the authoritative or optimistic thread key."):0,c.i64.neq(a[2],f)?d[6]=a[2]:d[6]=c.i64.cast([0,0]),d[5]?d[7]?c.seq([function(e){return d[1]?c.sp(b("LSDeleteThread"),a[1],!1):c.resolve()},function(a){return c.i64.neq(d[6],f)?c.fe(c.db.table(9).fetch([[[d[6]]]]),function(a){var b=a.update;a.item;return b({clientThreadKey:d[6]})}):c.resolve()},function(e){return c.sp(b("LSReplaceOptimisticThread"),d[6],a[1])},function(e){return c.sp(b("LSUpdateOptimisticContextThreadKeys"),d[6],a[1])}]):d[3]?c.sp(b("LSDeleteThread"),d[6],!1):c.resolve():d[3]?d[1]?c.sp(b("LSDeleteThread"),d[6],!1):c.seq([function(a){return c.i64.neq(d[6],f)?c.fe(c.db.table(9).fetch([[[d[6]]]]),function(a){var b=a.update;a.item;return b({clientThreadKey:d[6]})}):c.resolve()},function(e){return c.sp(b("LSReplaceOptimisticThread"),d[6],a[1])},function(e){return c.sp(b("LSUpdateOptimisticContextThreadKeys"),d[6],a[1])}]):c.resolve()},function(e){return d[3]?c.seq([function(e){return d[9]=c.i64.to_string(d[6]),d[8]=c.i64.to_string(a[1]),c.sp(b("LSUpdateTaskQueueName"),d[9],d[8])},function(a){return c.sp(b("LSUpdateTaskValue"),d[8],d[9],d[8])}]):c.resolve()}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSUpdateThreadAuthorityAndMappingWithOTIDFromJID",["LSShimGetServerThreadKeyFromJIDV2.nop","LSUpdateThreadAuthorityAndMapping"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return c.nop(b("LSShimGetServerThreadKeyFromJIDV2.nop"),a[0]).then(function(a){return a=a,d[0]=a[0],a})},function(e){return c.i64.neq(d[0],a[1])?d[1]=d[0]:d[1]=f,c.sp(b("LSUpdateThreadAuthorityAndMapping"),a[0],a[1],d[1])}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSShimVerifyThreadExists.nop",["I64","LSAuthorityLevel","LSContactGender","LSContactIdType","LSContactType","LSContactViewerRelationship","LSContactWorkForeignEntityType","LSFactory","LSGroupParticipantJoinState","LSIntEnum","LSVec","LSVerifyContactRowExists","MAWMiActCreateThreadInActWithMiData","Promise","ReQL","WALoggerDeferred","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Occamadillo] MI thread insertion for fbid: "," with last activity timestamp: "," and last read timestamp: ",", read = ",""]);i=function(){return a};return a}function j(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f){yield (h||(h=b("Promise"))).all(c("LSVec").toArray(f).map(function(b){return c("LSVerifyContactRowExists")(b,d("LSIntEnum").ofNumber(c("LSContactIdType").FBID),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactType").USER),void 0,void 0,void 0,void 0,!1,!1,d("LSIntEnum").ofNumber(0),void 0,!1,d("LSIntEnum").ofNumber(c("LSAuthorityLevel").OPTIMISTIC),void 0,void 0,d("LSIntEnum").ofNumber(c("LSContactWorkForeignEntityType").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactGender").UNKNOWN),d("LSIntEnum").ofNumber(c("LSContactViewerRelationship").UNKNOWN),void 0,c("LSFactory")(a)).then(function(){return a.table("participants").put({authorityLevel:d("LSIntEnum").ofNumber(c("LSAuthorityLevel").OPTIMISTIC),contactId:b,deliveredWatermarkTimestampMs:d("I64").zero,groupParticipantJoinState:d("LSIntEnum").ofNumber(c("LSGroupParticipantJoinState").MEMBER),isModerator:!1,readActionTimestampMs:d("I64").zero,readWatermarkTimestampMs:d("I64").zero,threadKey:e})})}))});return k.apply(this,arguments)}function l(a,b,c){return a.table("mi_act_mapping_table").put({clientThreadPk:d("I64").neg(b),jid:c,serverThreadKey:b})}a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,k,m,n){b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.table("mi_act_mapping_table")).getKeyRange(e)));b==null&&(yield l(a,e,f));c("promiseDone")(d("WALoggerDeferred").LOG(i(),d("I64").to_string(e),d("I64").to_string(m),d("I64").to_string(n),d("I64").le(m,n)));yield j(a,e,g);c("promiseDone")(d("MAWMiActCreateThreadInActWithMiData").miActCreateThreadInActWithMiData(e,f,m,n,k));return});function e(b,c,d,e,f,g,h,i,j){return a.apply(this,arguments)}return e}();g["default"]=a}),98);
__d("LSVerifyHybridThreadExists",["LSShimVerifyThreadExists.nop","LSVerifyE2EEMetadataThreadExistsV2"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return c.sp(b("LSVerifyE2EEMetadataThreadExistsV2"),a[2],a[0],c.i64.cast([0,60])).then(function(a){return a=a,d[0]=a[0],a})},function(a){return d[1]=c.i64.of_float(Date.now()),c.i64.neq(f,f)?c.seq([function(a){return c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,c.i64.cast([0,80]))}).next().then(function(a,b){var e=a.done;a=a.value;return e?d[4]=!1:(b=a.item,d[7]=b.deviceId,c.i64.neq(d[7],f)?d[6]=c.i64.neq(d[7],f):d[6]=!1,d[4]=d[6])})},function(a){return d[2]=d[4]}]):c.resolve(d[2]=!1)},function(e){return d[2]?d[3]=!0:d[3]=f,c.nop(b("LSShimVerifyThreadExists.nop"),a[0],a[1],a[3],a[4],a[5],a[6],a[7])},function(a){return e[0]=c.i64.cast([0,0])}])},function(a){return c.resolve(e)}])}c=a;f["default"]=c}),66);
__d("LSShimCopyAllParticipantNicknamesForThread",["gkx"],(function(a,b,c,d,e,f,g){function a(){var a=arguments,b=a[a.length-1];b.n;var d=[];return c("gkx")("4177")===!1?0:0,b.resolve(d)}b=a;g["default"]=b}),98);